################################################################################################
         PREPARING RASPBIAN OS FOR DISPLAY WAVESHARE DSI 4.3' 800x480 60HZ IPS REV 2.2
################################################################################################

Keep in mind that this guide is being built around the Display Waveshare 4.3' DSI 800x480 IPS 
rev 2.2, and a Raspberry Pi 4 Model B. This Display only supports Raspberry Pi 4 Model B (any 
rev of display) and Raspberry Pi 5 (rev 2.2+ of display), and only supports Raspbian OS Bullseye
or Bookworm. However, this guide will only focus on the use of this Display on a Raspberry Pi 4
Model B with Raspbian OS Bookworm x64.

The Display does not need Drivers to work as it connects to a DSI interface present on the 
Raspberry Pi 4 Model B. In this guide you will go through all the necessary steps to prepare 
the Display to work on the Raspberry Pi 4 Model B.

Starting...





--> Step 1

Place the SD Card you intend to use on your Raspberry Pi into your computer. You can use a USB, 
SD adapter or something similar.

--> Step 2

Open "Raspberry PI Imager". You can get a portable version of this program here at 
"Additional-Material" folder, in "Content to Download".

--> Step 3

Click on "CHOOSE DEVICE" and choose Raspberry Pi 4.

--> Step 4

Click "CHOOSE OS" to choose a desired version of Raspbian OS. Choose Raspbian OS Bookworm x64.

If you do not see the option to select Raspbian OS Bookworm through the Raspberry Pi Imager, 
then go to the link below, and open the image archive to browse the Bookworm image for 
download.
    - https://www.raspberrypi.com/software/operating-systems/
After downloading this image, still in option "CHOOSE OS" of the program, choose the 
"Use Custom" option to select the "IMG" file that you downloaded.

--> Step 5

Click on "CHOOSE STORAGE" and select your inserted SD Card, which you intend to use on the
Raspberry Pi. Now click "NEXT".

--> Step 6

In the dialog box that appears, click "EDIT SETTINGS".
    - In the "GENERAL" tab...
        - Check "Set Username And Password"
            - In "Username", enter "rpi" or something you prefer.
            - In "Password", enter the password that you want to use for your Raspberry Pi user
              and for the device SSH connections.
        - Check "Configure Wireless LAN"
            - In "SSID", enter the exact name of your home's WiFi network. The name of the network
              you want your Raspberry Pi to connect to.
            - In "Password", enter the exact password for this WiFi network.
            - In "Wireless LAN Country" select your country code.
        - Check "Set Locale Settings"
            - In "Time Zone" select your time zone.
            - In "Keyboard Layout" select the keyboard layout you intend to use.
    - In the "SERVICES" tab...
        - Check "Enable SSH"
            - Check "Use Password Authentication"

Finally, click "SAVE". Still in the dialog, click "YES". If your SD Card already contains information,
a warning will appear telling you that all content will be erased. Just confirm.

--> Step 7

Now just wait until the process is complete.

--> Step 8

Once the process finishes, a warning box will appear saying that you can now remove the SD Card. Click 
"CONTINUE". It is possible for the Raspberry Pi Imager to automatically eject your SD Card. If this 
happens, remove your SD Card from your computer and reinsert it.

Using Windows File Explorer, access your SD Card drive. Open the file "config.txt" which should be at 
the root of your SD Card. Add the following lines to the end of this file and save it...
    - dtoverlay=vc4-kms-v3d
    - dtoverlay=vc4-kms-dsi-7inch
Now, eject the SD Card and place it in the Raspberry Pi.

--> Step 9

Connect your Display to the DSI interface of the Raspberry Pi, using a flat cable like the images in
this Folder. If you are going to use a case with a fan or heat conductor, remember to buy and install
Thermal Pads to place between the chips and the heat conductor of the case (if necessary), as in the
images in this folder.

If you need more information about this procedure, consult the Wiki for this Display, located in the
"Content to Download" folder, inside "For Display Waveshare 4.3' 800x480 60hz" folder.

--> Step 10

Turn on your Raspberry Pi and wait a few moments to make sure the Raspberry Pi has booted up. If you've
done everything right so far, then when you turn on the Raspberry Pi, the Display should start displaying
an image and you'll be able to see the system booting and loading. This will probably take a few moments
and your device may restart a few times, since this is the first time you are turning on the new system. 
At the end of all this, you will be taken to the Raspbian OS Desktop.

Now, access your router's settings panel and check if the Raspberry Pi has already connected to your
home router, through the configured WiFi network. If the Raspberry Pi appeared on the router, copy its IP
in the local network.

If the Raspberry Pi does not appear connected to your router, try reloading the page, but if it persists
without appearing, this could mean that you have configured your Raspberry Pi's WiFi incorrectly.

--> Step 11

Using an SSH program like Putty, connect to your Raspberry Pi using the copied IP from router, and your
username and password configured in step 6. The connection can be made using the SSH version 2 protocol,
on port 22.

--> Step 12

Now, already connected, just use the commands below to make sure the system is up to date.
    - sudo apt update
    - sudo apt upgrade
    - sudo apt full-upgrade
    - sudo apt autoremove

--> Step 13

If everything has gone well so far, just connect a keyboard/mouse and continue as you wish!










################################################################################################
                                         OPTIONAL STEPS
################################################################################################

--> Downloading Ready-to-Use Image

If you want to download a ready-to-use image that already has the Display driver installed, go to
the "Content to Download" folder in "For Display Waveshare 4.3' 800x480 60hz" and download the
image. After downloading it, just use "Win32DiskImager" to write it to an SD Card and then place
it on your Raspberry Pi. This image is pristine, with the Raspberry Pi Bookworm and Display drivers
newly installed.

Once the image is installed on your SD Card, simply install the Display on the Raspberry Pi, turn
it on and test it.

This ready-to-use image has the following credentials for the user and for SSH.
User:     rpi
Password: 1234

Finally, remember to update this image using the commands below...
    - sudo apt update
    - sudo apt upgrade
    - sudo apt full-upgrade
    - sudo apt autoremove

NOTE: This ready-to-use image was extracted from a 32GB SanDisk Ultra SD Card. Furthermore, this 
      image is nothing more than a newly obtained Raspbian OS Bookworm x64, and nothing has been 
      removed or added other than the driver for this Display. So if you need to make any 
      configurations or adjustments (like changing the paging file, or network adjustments for 
      example), you will need to do this after writing this image to your SD Card and running it 
      on your Raspberry Pi.





--> Changing The Backlight of Display

WaveShare provides the corresponding demo for the application. Users can install it by the
following commands..
    - wget https://files.waveshare.com/upload/f/f4/Brightness.zip
    - unzip Brightness.zip
    - cd Brightness
    - sudo chmod +x install.sh
    - ./install.sh

NOTE: Alternatively, file "Brightness.zip" is available in this repository in the
"Content to Download" folder, inside "For Display Waveshare 4.3' 800x480 60hz" folder.

After installation, you can open it by "Raspberry" icon in the Task Bar > Accessories > Brightness.

Using the command below, you can also change the Display backlight brightness. Replace the "X"
with a number from 0 to 255, where 0 is darker and 255 is lighter...
    - echo X | sudo tee /sys/class/backlight/*/brightness





--> Configuring Other Things on the Display

By clicking on the Raspberry icon on the taskbar, and then on "Preferences" and then on
"Screen Configuration", you have access to some Display settings, as well as resolution, screen 
rotation and touch rotation.





--> Changing Display Rotation

With the "Screen Configuration" open, click on "Layout", then on "Screens", then "DS-1", then on
"Touchscreen" and finally "6-0038 generic ft5x06(79)".

Now click "Apply" and then close the current window. Reboot according to the pop-up prompts to
complete the specified touchscreen.

After Reboot, open "Screen Configuration" again and go to "Layout", then on "Screens", then "DS-1",
finally, choose "Orientation" and select one of the orientations.

To apply the changes, click "Apply".

NOTE: Make sure "6-0038 generic ft5x06(79)" is marked in "Layout", then on "Screens", then "DS-1",
then on "Touchscreen".





--> Turning Touch Input Off or On

If you want to turn off or turn on touch input on the Display, first use the command below...
    - sudo nano /boot/config.txt
At the end of the open file, add the line below...
    - disable_touchscreen=1
Save, and finally, just restart the system for the changes to be applied.

If you want to reactivate the Display's touch input, simply remove this line from the
"/boot/config.txt" file.